<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Teacher Dashboard (New)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="teacher.css" />
</head>
<body>
  <header>
    <h1>Teacher Dashboard <span id="teacherEmail" class="badge"></span></h1>
    <nav>
      <button data-tab="attempts" class="active">Attempts</button>
      <button data-tab="addq">Add Question</button>
      <button data-tab="deleteq">Delete Question</button>
      <button data-tab="users">Users</button>
      <button id="logoutBtn" title="Return to landing">Logout</button>
    </nav>
  </header>
  <main>
    <section id="tab-attempts" class="active">
      <div class="toolbar">
        <div><input type="text" id="searchStudent" placeholder="Search student (email / username / id)"></div>
        <div><input type="text" id="filterQuiz" placeholder="Filter quiz title"></div>
        <div><select id="completionFilter"><option value="all">All Status</option><option value="completed">Completed</option><option value="inprogress">In Progress</option></select></div>
        <div>
          <select id="scoreFilter">
            <option value="all">All Scores</option>
            <option value="50">≥ 50%</option>
            <option value="60">≥ 60%</option>
            <option value="70">≥ 70%</option>
            <option value="80">≥ 80%</option>
            <option value="90">≥ 90%</option>
            <option value="100">100%</option>
          </select>
        </div>
        <div>
          <select id="sortBy">
            <option value="default">Default sort</option>
            <option value="score-desc">Sort by Score (high → low)</option>
            <option value="score-asc">Sort by Score (low → high)</option>
          </select>
        </div>
        <div class="stat" id="statAttempts">Attempts: 0</div>
        <div class="stat" id="statAvg">Avg %: 0</div>
      </div>
      <div class="table-wrapper">
        <div class="table-scroller">
          <table id="attemptTable">
            <thead>
              <tr>
                <th data-sort="student">Student</th>
                <th data-sort="name">Full Name</th>
                <th data-sort="quiz">Quiz</th>
                <th data-sort="score">Score</th>
                <th data-sort="percent">Percent</th>
                <th data-sort="attempts">Attempts</th>
                <th data-sort="time">Time (s)</th>
                <th data-sort="start">Started</th>
                <th data-sort="end">Ended</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="tab-addq">
      <h2>Add Question</h2>
      <form id="addQuestionForm">
        <div class="row">
          <div><label>Quiz<select name="quizId" required></select></label></div>
          <div><label>Subject<select name="subjectId" required></select></label></div>
          <div><label>Question Number<input type="number" name="orderNum" title="Must be unique; becomes the visible question number"></label></div>
          <div><label>Points<input type="number" name="points" value="1"></label></div>
        </div>
        <label>Question Text<textarea name="questionText" rows="3" required></textarea></label>
        <div class="row">
          <div><label>Option A<input type="text" name="opt0" required></label></div>
          <div><label>Option B<input type="text" name="opt1" required></label></div>
        </div>
        <div class="row">
          <div><label>Option C<input type="text" name="opt2"></label></div>
          <div><label>Option D<input type="text" name="opt3"></label></div>
        </div>
        <div class="row">
          <div><label>Option E<input type="text" name="opt4"></label></div>
          <div><label>Correct<select name="correctIndex" required></select></label></div>
        </div>
        <button type="submit">Save Question</button>
        <div id="addQMsg" class="mini"></div>
      </form>
    </section>

    <section id="tab-deleteq">
      <h2>Delete Question</h2>
      <form id="deleteQuestionForm" class="inline">
        <label>Question Number <input type="number" name="questionId" required placeholder="Enter question number to remove"></label>
        <button type="submit" class="danger">Delete</button>
      </form>
      <div id="delQMsg" class="mini"></div>
      <p class="muted">
        Deleting a question cannot be undone and removes all options and related student answers. Enter the exact visible question number.
      </p>
    </section>

    <section id="tab-users">
      <h2>Users</h2>
      <div class="table-wrapper">
        <div class="table-scroller">
          <table id="usersTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Attempts</th>
                <th>Best %</th>
                <th>Last %</th>
                <th>Last Attempt</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase init + API shim -->
  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="firebase-api.js"></script>
  <!-- New teacher logic -->
  <script src="teacher2.js"></script>
</body>
</html>
